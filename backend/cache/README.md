# Сервис кеширования тайлов

Сервис для кеширования картографических тайлов с поддержкой различных бэкендов хранения.

## Реализации кеша

В проекте реализовано три варианта хранения кеша:

1. **MapCache** - хранение в памяти (sync.Map)
2. **FilesystemCache** - хранение на файловой системе
3. **SQLiteCache** - хранение в базе данных SQLite

## Результаты бенчмарков

### Операции записи

**Маленькие тайлы (1KB):**
| Реализация | Время на операцию | Память | Аллокации |
|------------|------------------|--------|-----------|
| MapCache | 220 ns/op | 64 B/op | 3 allocs/op |
| FilesystemCache | 8,081 ns/op | 146 B/op | 5 allocs/op |
| SQLiteCache | 78,235 ns/op | 615 B/op | 14 allocs/op |

**Большие тайлы (50KB):**
| Реализация | Время на операцию | Память | Аллокации |
|------------|------------------|--------|-----------|
| MapCache | 222 ns/op | 64 B/op | 3 allocs/op |
| FilesystemCache | 24,490 ns/op | 146 B/op | 5 allocs/op |
| SQLiteCache | 106,769 ns/op | 615 B/op | 14 allocs/op |

### Операции чтения

**Маленькие тайлы (1KB):**
| Реализация | Время на операцию | Память | Аллокации |
|------------|------------------|--------|-----------|
| MapCache | 50 ns/op | 0 B/op | 0 allocs/op |
| FilesystemCache | 6,985 ns/op | 1,484 B/op | 6 allocs/op |
| SQLiteCache | 22,873 ns/op | 2,896 B/op | 22 allocs/op |

**Большие тайлы (50KB):**
| Реализация | Время на операцию | Память | Аллокации |
|------------|------------------|--------|-----------|
| MapCache | 47 ns/op | 0 B/op | 0 allocs/op |
| FilesystemCache | 24,394 ns/op | 57,696 B/op | 6 allocs/op |
| SQLiteCache | 81,502 ns/op | 115,537 B/op | 22 allocs/op |

### Смешанные операции (80% чтение, 20% запись)

| Реализация | Время на операцию | Память | Аллокации |
|------------|------------------|--------|-----------|
| MapCache | 74 ns/op | 12 B/op | 0 allocs/op |
| FilesystemCache | 7,309 ns/op | 4,538 B/op | 4 allocs/op |
| SQLiteCache | 38,556 ns/op | 8,971 B/op | 17 allocs/op |

### Конкурентные операции

| Реализация | Время на операцию | Память | Аллокации |
|------------|------------------|--------|-----------|
| MapCache | 27 ns/op | 12 B/op | 0 allocs/op |
| FilesystemCache | 1,213 ns/op | 84 B/op | 3 allocs/op |
| SQLiteCache | 76,865 ns/op | 841 B/op | 15 allocs/op |

## Сравнительный анализ

### MapCache (In-Memory)
**Преимущества:**
- Самая высокая скорость работы (в 40-2800 раз быстрее других вариантов)
- Нулевые аллокации памяти при чтении
- Отличная производительность при конкурентном доступе
- Потокобезопасность (sync.Map)

**Недостатки:**
- Данные теряются при перезапуске
- Потребление RAM пропорционально размеру кеша
- Нет возможности запросов к данным

### FilesystemCache
**Преимущества:**
- Персистентное хранение данных
- Средняя производительность (компромисс между скоростью и надежностью)
- Простая структура хранения
- Низкое потребление памяти

**Недостатки:**
- В 40-520 раз медленнее MapCache
- Зависимость от производительности диска
- Отсутствие атомарных операций
- Нет возможности сложных запросов

### SQLiteCache
**Преимущества:**
- Персистентное хранение в СУБД
- Возможность SQL-запросов
- ACID-гарантии
- Структурированное хранение

**Недостатки:**
- Самая низкая производительность (в 350-2800 раз медленнее MapCache)
- Высокое потребление памяти на операцию
- Большое количество аллокаций

## Запуск бенчмарков

Для запуска всех бенчмарков:
```bash
make bench
```

Для запуска отдельных категорий:
```bash
make bench-set         # Только операции записи
make bench-get         # Только операции чтения
make bench-mixed       # Смешанные операции
make bench-concurrent  # Конкурентные операции
```

Для запуска бенчмарков конкретной реализации:
```bash
make bench-sqlite      # Только SQLite
make bench-map         # Только Map
make bench-filesystem  # Только Filesystem
```

Для быстрого запуска (1 секунда на тест):
```bash
make bench-quick
```

Для сохранения результатов в файл:
```bash
make bench-save
```
